---
const images = [
  { src: "/me/zk1.jpg", alt: "Zdeněk Kasner", credit: "adam&costey" },
  { src: "/me/zk3.jpg", alt: "Zdeněk Kasner" },
  { src: "/me/zk2.jpg", alt: "Zdeněk Kasner" },
];
---

<div class="mt-8 mb-4 grid grid-cols-3 gap-2 sm:gap-4">
  {
    images.map(image => (
      <div
        class="gallery-trigger group relative h-32 cursor-pointer overflow-hidden rounded-sm sm:h-48"
        data-src={image.src}
      >
        <img
          src={image.src}
          alt={image.alt}
          class="h-full w-full object-cover transition duration-300 group-hover:scale-105"
        />
        <div class="absolute inset-0 flex items-end justify-center opacity-0 transition-opacity duration-300 group-hover:opacity-100">
          <span class="w-full bg-black/70 px-2 py-1 text-center text-xs text-white">
            Photo: {image.credit}
          </span>
        </div>
      </div>
    ))
  }
</div>

<div
  id="lightbox"
  class="fixed inset-0 z-50 hidden items-center justify-center bg-black/90 p-4"
>
  <img
    id="lightbox-img"
    src=""
    class="max-h-full max-w-full rounded-sm object-contain shadow-2xl"
  />
</div>

<script>
  function initLightbox() {
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");
    const triggers = document.querySelectorAll(".gallery-trigger");

    triggers.forEach(trigger => {
      trigger.addEventListener("click", () => {
        const src = trigger.getAttribute("data-src");
        if (lightbox && lightboxImg && src) {
          (lightboxImg as HTMLImageElement).src = src;
          lightbox.classList.remove("hidden");
          lightbox.classList.add("flex");
        }
      });
    });

    lightbox?.addEventListener("click", () => {
      lightbox.classList.add("hidden");
      lightbox.classList.remove("flex");
    });

    document.addEventListener("keydown", event => {
      if (event.key === "Escape") {
        lightbox?.classList.add("hidden");
        lightbox?.classList.remove("flex");
      }
    });
  }

  // Run on initial load
  initLightbox();

  // Run on view transitions navigation
  document.addEventListener("astro:page-load", initLightbox);
</script>
